---
title: "Shiny Server Setup"
summary: "This document will outline the process of setting up Shiny Server in a Linux-based virtual machine."
author: Daniel Molitor
date: "2022-03-11"
output: md_document
categories: ["R", "Shiny", "Linux"]
image:
  caption: ""
  focal_point: ""
  placement: 2
  preview_only: false
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<p>Because of the number of computing platforms and the varied processes involved
in setting up a virtual machine (VM) on each of them, this tutorial will begin
under the assumption that you have already established and connected to a
suitable VM. For my own personal uses I am using a Digital Ocean VM with
Ubuntu 20.04 Focal Fossa as the OS.</p>
<p>Additionally, this document is effectively just a personal wiki and some steps
are pretty specific to my own setup so mileage may vary.</p>
<div id="install-rshiny-server-and-all-dependencies" class="section level2">
<h2>Install R/Shiny Server and all dependencies</h2>
<p>The first step is to install the most recent version of R, as well as a robust
set of the most important R packages.
{{% callout note %}}
This installation will take &gt;= 2 hrs on most VMs.
{{% /callout %}}</p>
<pre><code># Update indices
sudo apt update -y -qq

# Install the dependencies necessary to add a new repository over HTTPS:
sudo apt-get -y install \
    dirmngr \
    gnupg \
    apt-transport-https \
    ca-certificates \
    software-properties-common

# Add the CRAN repository to your system sources list:
#   - Add the signing key (by Michael Rutter) for these repos
#     To verify key, run gpg --show-keys /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc 
#     Fingerprint: 298A3A825C0D65DFD57CBB651716619E084DAB9
sudo wget -qO- https://cloud.r-project.org/bin/linux/ubuntu/marutter_pubkey.asc | sudo tee -a /etc/apt/trusted.gpg.d/cran_ubuntu_key.asc
#   - Add the R 4.0 repo from CRAN
sudo add-apt-repository &quot;deb https://cloud.r-project.org/bin/linux/ubuntu focal-cran40/&quot;

# Install base R and dependencies for full set of R packages
sudo apt-get -y install \
    r-base \
    r-base-dev \
    libssl-dev \
    libcurl4-openssl-dev \
    libxml2-dev \
    libfontconfig1-dev \
    libcairo2-dev \
    libgmp3-dev \
    libmpfr-dev \
    libv8-dev \
    unixodbc-dev \
    libpq-dev \
    libudunits2-dev \
    libgdal-dev \
    gsl-bin \
    libgsl0-dev \
    libharfbuzz-dev \
    libfribidi-dev \
    cmake

# Install R packages
sudo R -e &#39;install.packages(read.table(&quot;https://gist.githubusercontent.com/dmolitor/f88b3edd1fd02716ff08888a815db35a/raw/8298cc7d28aa0c03a7e0330e338fa7c85d0ee782/r-packages.txt&quot;)[[&quot;V1&quot;]], Ncpus = parallel::detectCores())&#39;</code></pre>
<p>Once R and the packages have been installed, the next step is to install Shiny
Server and all its dependencies.</p>
<pre><code># Install Shiny Server and dependencies
sudo apt-get -y install gdebi-core
wget https://download3.rstudio.org/ubuntu-14.04/x86_64/shiny-server-1.5.17.973-amd64.deb
sudo gdebi -n shiny-server-1.5.17.973-amd64.deb</code></pre>
</div>
<div id="verify-shiny-server-is-running" class="section level2">
<h2>Verify Shiny Server is running</h2>
<p>Locate the public IP of your VM and in your web browser enter
<code>http://vm.public.ip:3838/</code>. If Shiny Server is active and running correctly,
you should see something like the following:
<img src="shiny-welcome.png" /></p>
</div>
<div id="configure-shiny-server-as-git-repo" class="section level2">
<h2>Configure Shiny Server as Git repo</h2>
<pre><code># Ensure shiny-server directory has full read/write permissions
sudo chmod -R 777 /srv/shiny-server

# Generate new SSH key for connecting to Github (just hit enter for all prompts)
ssh-keygen -t ed25519
eval &quot;$(ssh-agent -s)&quot;
ssh-add ~/.ssh/id_ed25519</code></pre>
<p>The steps above generate a new SSH key, but now you must add this SSH key to
your Github account. To do so, follow the steps in
<a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account">this article</a> closely. Now that youâ€™ve added the SSH key to your Github account,
itâ€™s time to configure your Github credentials and clone your Shiny Server repo
to the VM. To do this, execute:</p>
<pre><code># Configure git credentials
git config --global user.email &quot;you@example.com&quot;
git config --global user.name &quot;Your Name&quot;

# Navigate to shiny-server directory
cd /srv/shiny-server
sudo rm -r *
git init

# Clone repo
git remote add origin git@github.com:path-to-repo-head.git
git pull origin master
git branch --set-upstream-to=origin/master master
cd ~</code></pre>
</div>
<div id="install-and-configure-nginx" class="section level2">
<h2>Install and configure nginx</h2>
<pre><code># Install nginx
sudo apt-get -y install nginx

# Edit nginx config
sudo vi /etc/nginx/sites-enabled/default</code></pre>
<p>This will open the <code>nginx</code> config file. Add the following lines <strong>above</strong> the
line that reads <code>server {</code></p>
<pre><code>map $http_upgrade $connection_upgrade {
  default upgrade;
  &#39;&#39;      close;
}</code></pre>
<p>And add the following lines right <strong>after</strong> the line that reads <code>server_name _;</code></p>
<pre><code>location /shiny/ {
  proxy_pass http://127.0.0.1:3838/;
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection $connection_upgrade;
  rewrite ^(/shiny/[^/]+)$ $1/ permanent;
}</code></pre>
<p>Now, save the changes. Since you edited the <code>nginx</code> config file you will need to
restart the service with <code>sudo service nginx restart</code>. Now, instead of accessing
Shiny Server with <code>http://vm.public.ip:3838</code> you should be able to access it
with <code>http://vm.public.ip/shiny</code>.</p>
<p>The final step in configuring <code>nginx</code> is to overwrite the default .html landing
page with a personalized landing page.
{{% callout note %}}
This assumes that you have a file named
<code>index.nginx-debian.html</code> in the root of your <code>shiny-server</code> github repo.
{{% /callout %}}</p>
<pre><code>sudo cp -rf /srv/shiny-server/index.nginx-debian.html /var/www/html/</code></pre>
<p>Now, when you access <code>http://vm.public.ip</code>, you should see a pretty landing
page.</p>
</div>
<div id="bonus-stuff-configuring-basic-authentication" class="section level2">
<h2>Bonus Stuff (Configuring Basic Authentication)</h2>
<p>Obviously, setting up some form of basic authentication will depend on your
desired level of privacy. Also this will probably keep the average person from
accessing your apps but definitely is a fairly light level of security.
Anywho, letâ€™s proceedâ€¦</p>
<pre><code># Install necessary dependency
sudo apt-get install apache2-utils

# Shut down Shiny Server and nginx
sudo service nginx stop
sudo service shiny-server stop

# Edit nginx default config
sudo vi /etc/nginx/sites-available/default</code></pre>
<p>Once you are in the file, you will tweak the existing server function as
follows:</p>
<pre><code>server {
        listen 80 default_server;
        listen [::]:80 default_server;

        ### Authentication ###     &lt;------ YOU MUST COPY/PASTE IN THIS WHOLE AUTH CHUNK
        auth_basic &quot;Username and Password are required&quot;;
        auth_basic_user_file /etc/nginx/.htpasswd;
        ######################</code></pre>
<p>Then, within the <code>location /shiny/ {</code> chunk, enter the following:</p>
<pre><code>auth_basic on;</code></pre>
<p>Now, save and exit the file. Next you need to create a <code>username</code> user and
corresponding password <code>user-password</code> at the hint like:</p>
<pre><code>cd /etc/nginx
sudo htpasswd -c /etc/nginx/.htpasswd username

# Restart the services!
cd ~
sudo service nginx start
sudo service shiny-server start</code></pre>
<p>You have now established basic authentication and when you access any page on
your server you should see something like the following:
<img src="basic-auth.png" /></p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>You have now configured Shiny Server and can view it at
<code>http://vm.public.ip/shiny/</code>! ðŸŽ‰ðŸ¥³</p>
</div>
